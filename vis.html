<html>
<head>
    <title>CodeDNA</title>
    <link rel="stylesheet" href="vis.css" type="text/css" />
    <xlink href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
    <xscript type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
    <xscript type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../d3/d3.js?2.4.6"></script>
    <script type="text/javascript" src="../d3/d3.layout.js?2.4.6"></script>
    <xscript type="text/javascript" src="processed/git%253A%252F%252Fgithub.com%252FMobisocial%252Fdungbeetle.json"></script>
    <script type="text/javascript" src="processed/git%253A%252F%252Fgithub.com%252Fmbostock%252Fd3.json"></script>
    <xscript type="text/javascript" src="processed/git%253A%252F%252Fgithub.com%252Ftpurtell%252Fsocialbar.json"></script>
    <xscript type="text/javascript" src="processed/git%253A%252F%252Fgithub.com%252Ftpurtell%252Fwhoiswatching.json"></script>
</head>
<body>
    <script type="text/javascript">


var CodeA = 'a'.charCodeAt(0); 
var CodeZ = 'z'.charCodeAt(0); 
function computePosition(entry) {
    var word = entry.term;
    word = word.toLowerCase();
    while(word.length > 0 && (word.charCodeAt(0) < CodeA || word.charCodeAt(0) > CodeZ))
        word = word.substring(1);
    
    var min = 0;
    var max = 1;
    var per_slot = 1.0 / (CodeZ - CodeA + 1);
    for(var i = 0; i < word.length; ++i) {
        var slot = word.charCodeAt(i) - CodeA;
        var new_slot = (max - min) * per_slot;
        min += new_slot * slot;
        max += new_slot * (slot + 1);
    }
    entry.min = min;
    entry.max = max;
    entry.mid = (min + max) / 2;
    return entry;
}
    
var commit = data.revisions[100];
alert(commit);
//var words = data.words[commit];
var words = data.merged;
var sorted = [];

max_score = 0;
for(var term in words) {
    sorted.push({term:term, score:words[term]});
    if(Math.abs(words[term]) > max_score)
        max_score = Math.abs(words[term]);
}
sorted.sort(function(a,b) { 
    if(a.term.toLowerCase() < b.term.toLowerCase()) 
        return -1; 
    else if(a.term.toLowerCase() > b.term.toLowerCase()) 
        return 1;
    else
        return 0;
});
data = sorted.filter(function(v) {
    return v.score > 1 && v.term.length > 3;
});
data = data.map(computePosition);
var w = document.body.offsetWidth - 40,
    h = document.body.offsetHeight - 20,
    x = d3.scale.linear().domain([0, 1]).range([0, w]),
    y = d3.scale.ordinal().domain(d3.range(data.length)).rangeBands([0, h], .2);

var vis = d3.select("body")
  .append("svg:svg")
    .attr("width", w + 40)
    .attr("height", h + 20)
  .append("svg:g")
    .attr("transform", "translate(20,0)");

var bars = vis.selectAll("g.bar")
    .data(data)
  .enter().append("svg:g")
    .attr("class", "bar")
    .attr("transform", function(d, i) { return "translate(0," + y(i) + ")"; });

bars.append("svg:rect")
    .attr("fill", "steelblue")
    .attr("x", 0)
    .attr("y", function(d, i) { 
        return y(i); 
     })
    .attr("width", function(d, i) { 
        return x(Math.abs(d.score / max_score)); 
     })
    .attr("height", y.rangeBand());

//bars.append("svg:text")
//    .attr("x", x)
//    .attr("y", y.rangeBand() / 2)
//    .attr("dx", -6)
//    .attr("dy", ".35em")
//    .attr("fill", "white")
//    .attr("text-anchor", "end")
//    .text(x.tickFormat(100));

//bars.append("svg:text")
//    .attr("x", 0)
//    .attr("y", y.rangeBand() / 2)
//    .attr("dx", -6)
//    .attr("dy", ".35em")
//    .attr("text-anchor", "end")
//    .text(function(d, i) { return String.fromCharCode(65 + i); });

var rules = vis.selectAll("g.rule")
    .data(x.ticks(10))
  .enter().append("svg:g")
    .attr("class", "rule")
    .attr("transform", function(d) { return "translate(" + x(d) + ",0)"; });

rules.append("svg:line")
    .attr("y1", h)
    .attr("y2", h + 6)
    .attr("stroke", "black");

rules.append("svg:line")
    .attr("y1", 0)
    .attr("y2", h)
    .attr("stroke", "white")
    .attr("stroke-opacity", .3);

rules.append("svg:text")
    .attr("y", h + 9)
    .attr("dy", ".71em")
    .attr("text-anchor", "middle")
    .text(x.tickFormat(10));

vis.append("svg:line")
    .attr("y1", 0)
    .attr("y2", h)
    .attr("stroke", "black");

    </script>
</body>
</html>
